<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vicioware</title>
    <style>
        @font-face {
            font-family: 'Manrope'; /* Nombre que le damos a la fuente para usarla luego */
            src: url('fonts/Manrope-SemiBold.ttf') format('truetype'); /* Ruta al archivo de la fuente y su formato. Asegúrate que el archivo existe. */
            font-weight: 400; /* 'Regular' suele corresponder a un peso de 400. Si es 'Light', usa 300 y el archivo correcto. */
            font-style: normal;
        }

        body {
            font-family: 'Manrope', sans-serif; /* Usamos Manrope, con sans-serif como fallback */
            margin: 0;
            background-color: #1c1c1c; /* Nuevo color de fondo */
            color: #f0f0f0; /* Color de texto general claro para contraste */
        }
        #searchBar {
            display: block; /* Para poder aplicar márgenes automáticos y centrar */
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #555;
            background-color: #2a2a2a;
            color: #f0f0f0;
            font-size: 0.9em;
            width: 400px; /* Ancho aumentado */
            max-width: 90%; /* Para asegurar que no se desborde en pantallas pequeñas */
            font-family: 'Manrope', sans-serif;
            outline: none;
            margin: 20px auto; /* Centra la barra y añade margen superior/inferior */
        }
        .gallery-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start; /* Alinea los items a la izquierda */
            padding: 10px; /* Margen leve alrededor del contenedor */
            gap: 10px; /* Espacio leve entre los elementos */
        }
        .game-item {
            position: relative; /* Necesario para el posicionamiento absoluto del pseudo-elemento ::after */
            background: linear-gradient(to bottom, #1a1a1a, #111111 40%, #0a0a0a); /* Estilo metálico mate oscuro */
            border-radius: 8px;
            text-align: center;
            width: 120px; /* Ancho reducido en un 40% */
            overflow: visible; /* Permitir que el resplandor del pseudo-elemento se muestre fuera */
            text-decoration: none; /* Quita el subrayado del enlace */
            transition: transform 0.2s ease-in-out; /* Mantenemos la transición de hover */
            z-index: 1; /* Asegurar que la tarjeta esté por encima de otros elementos si es necesario */
        }
        .game-item::before, .game-item::after { /* Estilos comunes para ambos pseudo-elementos de resplandor */
            content: '';
            position: absolute;
            opacity: 0;
        }
        .game-item::after { /* Pseudo-elemento para el efecto de resplandor de colores (lava lamp) */
            z-index: -2; /* Detrás del resplandor blanco y del contenido de .game-item */
            inset: -6px; /* Ligeramente más grande que la tarjeta para el efecto glow */
            /* Ahora un solo color, el predominante de la imagen, con un fallback */
            background: var(--dominant-glow-color, rgba(200, 200, 200, 0.2)); /* Fallback: gris claro semitransparente */
            /* Ya no se necesita animación ni background-size para un solo color */
            filter: blur(12px); /* Desenfoque para el efecto de resplandor */
            border-radius: 14px; /* (radio original de la tarjeta + valor de inset) */
            transition: opacity 0.4s ease-in-out;
        }
        .game-item::before { /* Pseudo-elemento para el resplandor blanco de contorno */
            z-index: -1; /* Encima del resplandor de colores, detrás del contenido de .game-item */
            inset: 0; /* Coincide con el tamaño de la tarjeta */
            border-radius: 8px; /* Mismo borde que la tarjeta */
            /* Sombra blanca para el contorno, menos intensa que el resplandor de colores */
            box-shadow: 0 0 7px 2px rgba(255, 255, 255, 0.35); 
            transition: opacity 0.3s ease-in-out;
        }
        .game-item:hover {
            transform: scale(1.05); /* Efecto de zoom al pasar el ratón */
        }
        .game-item:hover::after {
            opacity: 0.7; /* Mostrar el resplandor en hover, ajusta la opacidad según prefieras */
        }
        .game-item:hover::before {
            opacity: 1; /* Mostrar el resplandor blanco. La intensidad se controla con la opacidad de la box-shadow */
        }
        .game-item img {
            width: 100%; /* La imagen ocupa todo el ancho del contenedor */
            height: auto; /* Mantiene la proporción de la imagen */
            display: block; /* Ayuda a evitar espacios extra y asegura que el border-radius se aplique bien */
            border-top-left-radius: 8px; /* Redondear esquinas superiores de la imagen */
            border-top-right-radius: 8px; /* Redondear esquinas superiores de la imagen */
        }
        .game-item p {
            margin: 10px 0; /* Margen para el nombre del juego */
            font-size: 0.9em;
            color: #fff; /* Texto blanco */
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.4); /* Resplandor suave para legibilidad */
            padding: 0 5px; /* Espacio para que el texto no toque los bordes */
        }
    </style>
    <style>
        /* Modal Styles */
        .modal {
            display: flex; /* Usamos flex para centrar el contenido */
            align-items: center; /* Centrado vertical */
            justify-content: center; /* Centrado horizontal */
            position: fixed; /* Stay in place */
            z-index: 100; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            /* Propiedades para la animación de apertura/cierre */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s; /* visibility cambia después de que la opacidad se desvanece */
        }

        .modal.is-open {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s; /* Asegura que la visibilidad sea inmediata al abrir */
        }

        .modal-content {
            background-color: #1c1c1c;
            padding: 25px;
            border: 1px solid #444; /* Borde ligeramente oscurecido */
            width: 90%; 
            max-width: 550px; 
            border-radius: 10px;
            position: relative;
            color: #f0f0f0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transform: translateY(-30px) scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 30px;
            font-weight: bold;
            line-height: 1;
        }

        .close-button:hover,
        .close-button:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }

        .modal.is-open .modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        #modalGameTitle {
            text-align: center;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 1px solid #444;
            padding-bottom: 0.5em;
        }

        #modalDownloadLinks {
            list-style: none;
            padding: 0;
        }

        #modalDownloadLinks li {
            margin-bottom: 12px;
        }

        #modalDownloadLinks a {
            display: block; /* Make links take full width */
            background-color: #5ac560; /* Nuevo color base del botón */
            color: white;
            padding: 12px 18px;
            text-decoration: none;
            border-radius: 6px;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            text-align: center;
            font-size: 1em;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4); /* Sombra negra suave para el texto */
        }

        #modalDownloadLinks a:hover {
            background-color: #5ac560;
            transform: translateY(0px) scale(1.02); /* Efecto de elevación y agrandamiento suave */
            box-shadow: 0 0 10px 2px rgba(110, 255, 102, 0.644); /* Glow suave del color #2fc427 */
        }
    </style>
    <style>
        body.modal-blur-active > .gallery-container { /* Solo afecta al gallery-container */
            filter: blur(5px);
            transition: filter 0.3s ease-in-out;
        }
        .gallery-container { /* Para asegurar un des-desenfoque suave */
            transition: filter 0.3s ease-in-out;
        }
    </style>
</head>
<body>

    <input type="search" id="searchBar" placeholder="Buscar juegos...">

    <div class="gallery-container">
        <a href="#" data-game-id="halo-ce" class="game-item">
            <img src="portadas/halo-ce.png" loading="lazy">
            <p>Halo: Combat Evolved</p>
        </a>

        <a href="#" data-game-id="gta-sa" class="game-item">
            <img src="portadas/gta-sa.png" loading="lazy">
            <p>Grand Theft Auto: San Andreas</p>
        </a>

        <a href="#" data-game-id="cuphead" class="game-item">
            <img src="portadas/cuphead.png" loading="lazy">
            <p>Cuphead</p>
        </a>

        <a href="#" data-game-id="unmetal" class="game-item">
            <img src="portadas/unmetal.png" loading="lazy">
            <p>Unmetal</p>
        </a>

        <a href="#" data-game-id="portal" class="game-item">
            <img src="portadas/portal.png" loading="lazy">
            <p>Portal</p>
        </a>

        <a href="#" data-game-id="portal2" class="game-item">
            <img src="portadas/portal2.png" loading="lazy">
            <p>Portal 2</p>
        </a>

        <a href="#" data-game-id="REPO" class="game-item">
            <img src="portadas/REPO.png" loading="lazy">
            <p>R.E.P.O</p>
        </a>

        <a href="#" data-game-id="dbfz" class="game-item">
            <img src="portadas/dbfz.png" loading="lazy">
            <p>Dragon Ball FighterZ</p>
        </a>

        <a href="#" data-game-id="brotato" class="game-item">
            <img src="portadas/brotato.png" loading="lazy">
            <p>Brotato</p>
        </a>

        <a href="#" data-game-id="assassinscreed" class="game-item">
            <img src="portadas/assassinscreed.png" loading="lazy">
            <p>Assassin's Creed</p>
        </a>

        <a href="#" data-game-id="tomb-raider" class="game-item">
            <img src="portadas/tomb-raider.png" loading="lazy">
            <p>Tomb Raider (2013)</p>
        </a>

        <a href="#" data-game-id="vampire-survivors" class="game-item">
            <img src="portadas/vampire-survivors.png" loading="lazy">
            <p>Vampire Survivors</p>
        </a>

        <a href="#" data-game-id="horizon-chase-turbo" class="game-item">
            <img src="portadas/horizon-chase-turbo.png" loading="lazy">
            <p>Horizon Chase Turbo</p>
        </a>

        <a href="#" data-game-id="barony" class="game-item">
            <img src="portadas/barony.png" loading="lazy">
            <p>Barony</p>
        </a>

        <a href="#" data-game-id="dmc-devil-may-cry" class="game-item">
            <img src="portadas/dmc-devil-may-cry.png" loading="lazy">
            <p>DmC: Devil May Cry</p>
        </a>

        <a href="#" data-game-id="call-of-duty" class="game-item">
            <img src="portadas/call-of-duty.png" loading="lazy">
            <p>Call of Duty</p>
        </a>
    </div>

    <!-- Modal Structure -->
    <div id="downloadModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modalGameTitle">Nombre del Juego</h2>
            <ul id="modalDownloadLinks">
                <!-- Download links will be populated here by JavaScript -->
            </ul>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.4.0/color-thief.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const gameItems = document.querySelectorAll('.game-item');
            const colorThief = new ColorThief();

            // Modal elements
            const modal = document.getElementById('downloadModal');
            const modalGameTitle = document.getElementById('modalGameTitle');
            const modalDownloadLinksList = document.getElementById('modalDownloadLinks');
            const closeButton = modal.querySelector('.close-button');
            const searchBar = document.getElementById('searchBar');

            // Data for download links
            const gameDownloadLinksData = {
                'halo-ce': [
                    { text: 'Descargar Halo: CE (Servidor 1)', url: 'https://example.com/halo-ce-link1' },
                    { text: 'Descargar Halo: CE (Servidor 2)', url: 'https://example.com/halo-ce-link2' }
                ],
                'gta-sa': [ { text: 'Descargar GTA: San Andreas', url: 'https://example.com/gta-sa-link' } ],
                'cuphead': [
                    { text: 'Descargar Cuphead (Principal)', url: 'https://example.com/cuphead-main' },
                    { text: 'Descargar Cuphead (Alternativo)', url: 'https://example.com/cuphead-alt' }
                ],
                'unmetal': [{ text: 'Descargar Unmetal', url: 'https://example.com/unmetal-download' }],
                'portal': [{ text: 'Descargar Portal', url: 'https://example.com/portal-download' }],
                'portal2': [{ text: 'Descargar Portal 2', url: 'https://example.com/portal2-download' }],
                'REPO': [{ text: 'Descargar R.E.P.O', url: 'https://example.com/repo-download' }],
                'dbfz': [{ text: 'Descargar Dragon Ball FighterZ', url: 'https://example.com/dbfz-download' }],
                'brotato': [{ text: 'Descargar Brotato', url: 'https://example.com/brotato-download' }],
                'assassinscreed': [{ text: 'Descargar Assassin\'s Creed', url: 'https://example.com/assassinscreed-download' }],
                'tomb-raider': [{ text: 'Descargar Tomb Raider (2013)', url: 'https://example.com/tomb-raider-download' }],
                'vampire-survivors': [{ text: 'Descargar Vampire Survivors', url: 'https://example.com/vampire-survivors-download' }],
                'horizon-chase-turbo': [{ text: 'Descargar Horizon Chase Turbo', url: 'https://example.com/horizon-chase-turbo-download' }],
                'barony': [{ text: 'Descargar Barony', url: 'https://example.com/barony-download' }],
                'dmc-devil-may-cry': [{ text: 'Descargar DmC: Devil May Cry', url: 'https://example.com/dmc-devil-may-cry-download' }],
                'call-of-duty': [{ text: 'Descargar Call of Duty', url: 'https://example.com/call-of-duty-download' }]
                // Asegúrate de que todos los game-id de tus tarjetas estén aquí con sus enlaces
            };

            function openModal(gameId, gameName) {
                modalGameTitle.textContent = gameName; // Actualiza el título del modal
                modalDownloadLinksList.innerHTML = ''; // Limpia enlaces anteriores

                if (gameId && gameDownloadLinksData[gameId]) {
                    const links = gameDownloadLinksData[gameId];
                    links.forEach(linkInfo => {
                        const listItem = document.createElement('li');
                        const anchor = document.createElement('a');
                        anchor.href = linkInfo.url;
                        anchor.textContent = linkInfo.text;
                        anchor.target = '_blank'; // Abrir en nueva pestaña
                        listItem.appendChild(anchor);
                        modalDownloadLinksList.appendChild(listItem);
                    });
                } else {
                    const listItem = document.createElement('li');
                    listItem.textContent = 'No hay enlaces de descarga disponibles para este juego.';
                    modalDownloadLinksList.appendChild(listItem);
                    console.warn('No se encontraron enlaces de descarga para el juego:', gameId);
                }
                document.body.classList.add('modal-blur-active'); // Aplicar desenfoque al fondo
                modal.classList.add('is-open'); // Mostrar y animar modal
            }

            function closeModal() {
                document.body.classList.remove('modal-blur-active'); // Quitar desenfoque
+                modal.classList.remove('is-open'); // Ocultar y animar modal
            }

            // Event listener para el botón de cierre del modal
            closeButton.addEventListener('click', closeModal);

            // Event listener para cerrar el modal haciendo clic fuera de su contenido
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    closeModal();
                }
            });

            // Event listener para cerrar el modal con la tecla Escape
            window.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && modal.style.display === 'block') {
                    closeModal();
                }
            });

            // Función para limpiar cadenas para la búsqueda (ignorar mayúsculas/minúsculas y caracteres especiales)
            function sanitizeSearchTerm(term) {
                return term.toLowerCase().replace(/[^a-z0-9]/g, '');
            }

            // Event listener para la barra de búsqueda
            searchBar.addEventListener('input', (event) => {
                const rawSearchTerm = event.target.value.trim();
                const sanitizedSearchTerm = sanitizeSearchTerm(rawSearchTerm);

                gameItems.forEach(item => {
                    const rawGameTitle = item.querySelector('p').textContent;
                    const sanitizedGameTitle = sanitizeSearchTerm(rawGameTitle);
                    if (sanitizedGameTitle.includes(sanitizedSearchTerm)) {
                        item.style.display = ''; // Muestra el item si coincide
                    } else {
                        item.style.display = 'none'; // Oculta el item si no coincide
                    }
                });
            });

            gameItems.forEach(item => {
                const img = item.querySelector('img');
                let dynamicGlowColors = null; // Para almacenar los colores extraídos para este item

                function extractAndStoreColors() {
                    // Asegurarse de que la imagen esté completamente cargada y tenga dimensiones
                    if (img.complete && img.naturalWidth > 0 && img.naturalHeight > 0) {
                        try {
                            const dominantColorArray = colorThief.getColor(img); // Extraer el color dominante [R, G, B]
                            
                            if (dominantColorArray) {
                                dynamicGlowColors = {};
                                const rgbString = `rgb(${dominantColorArray[0]}, ${dominantColorArray[1]}, ${dominantColorArray[2]})`;
                                dynamicGlowColors['--dominant-glow-color'] = rgbString;
                            } else {
                                console.warn('ColorThief: No se pudo extraer una paleta para:', img.src);
                                dynamicGlowColors = null;
                            }
                        } catch (error) {
                            console.error('ColorThief error para la imagen:', img.src, error);
                            dynamicGlowColors = null;
                        }
                    } else if (!img.complete) {
                        // Si la imagen aún no está completa, no hacer nada aquí, el 'load' listener se encargará.
                    } else {
                        // La imagen está 'complete' pero no tiene dimensiones (ej. imagen rota)
                        console.warn('ColorThief: Imagen cargada pero inválida (sin dimensiones):', img.src);
                        dynamicGlowColors = null;
                    }
                }

                // Intentar extraer colores si la imagen ya está cargada
                // (importante para imágenes cacheadas o ya visibles)
                if (img.complete && img.naturalWidth > 0) {
                    extractAndStoreColors();
                }
                // Siempre añadir el listener 'load' para imágenes que cargan después (incluyendo lazy-loaded)
                img.addEventListener('load', extractAndStoreColors);
                img.addEventListener('error', () => {
                    console.error('Error al cargar la imagen:', img.src);
                    dynamicGlowColors = null;
                });

                item.addEventListener('mouseenter', () => {
                    if (dynamicGlowColors) {
                        for (const [variable, color] of Object.entries(dynamicGlowColors)) {
                            item.style.setProperty(variable, color);
                        }
                    }
                });

                item.addEventListener('mouseleave', () => {
                    // La transición de opacidad para .game-item::after es de 0.4s (400ms).
                    // Retrasamos la eliminación de las variables de color para que coincida
                    // con la duración de la transición, evitando el parpadeo de los colores por defecto.
                    setTimeout(() => {
                        // Solo eliminar las propiedades si el cursor no ha vuelto a entrar en la tarjeta
                        // y si se habían establecido colores dinámicos.
                        if (dynamicGlowColors && !item.matches(':hover')) {
                            item.style.removeProperty('--dominant-glow-color');
                        }
                    }, 400); // Coincide con la duración de la transición de opacidad de ::after
                });

                // Event listener para abrir el modal al hacer clic en la tarjeta
                item.addEventListener('click', (event) => {
                    event.preventDefault(); // Previene la acción por defecto del enlace (navegar a #)
                    
                    const gameId = item.dataset.gameId;
                    const gameName = item.querySelector('p').textContent;

                    if (gameId) {
                        openModal(gameId, gameName);
                    } else {
                        console.error('Atributo data-game-id no encontrado en el item:', item);
                    }
                });
            });
        });
    </script>
</body>
</html>
