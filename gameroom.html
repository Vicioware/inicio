<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="resources/favicon_16x16.png" sizes="16x16" type="image/png">
    <link rel="icon" href="resources/favicon_32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="resources/favicon_48x48.png" sizes="48x48" type="image/png">
    <link rel="icon" href="resources/favicon_192x192.png" sizes="192x192" type="image/png">
    <title>Vicioroom</title>
    <style>
        @font-face {
            font-family: 'Manrope';
            src: url('fonts/Manrope-SemiBold.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }

        body {
            font-family: 'Manrope', sans-serif;
            margin: 0;
            background-color: #1c1c1c;
            color: #f0f0f0;
            /* padding: 20px; Ya no es necesario con la galería centrada */
            /* box-sizing: border-box; */
        }
        .gallery-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 20px; /* Espacio alrededor de la galería */
            gap: 10px;
        }
        .game-item {
            position: relative;
            background: linear-gradient(to bottom, #1a1a1a, #111111 40%, #0a0a0a);
            border-radius: 8px;
            text-align: center;
            width: 120px;
            overflow: visible;
            text-decoration: none;
            transition: transform 0.2s ease-in-out;
            z-index: 1;
        }
        .game-item::before, .game-item::after {
            content: '';
            position: absolute;
            opacity: 0;
        }
        .game-item::after {
            z-index: -2;
            inset: -6px;
            background: var(--dominant-glow-color, rgba(200, 200, 200, 0.2));
            filter: blur(12px);
            border-radius: 14px;
            transition: opacity 0.4s ease-in-out;
        }
        .game-item::before {
            z-index: -1;
            inset: 0;
            border-radius: 8px;
            box-shadow: 0 0 7px 2px rgba(255, 255, 255, 0.35);
            transition: opacity 0.3s ease-in-out;
        }
        .game-item:hover {
            transform: scale(1.05);
        }
        .game-item:hover::after {
            opacity: 0.7;
        }
        .game-item:hover::before {
            opacity: 1;
        }
        .game-item img {
            width: 100%;
            height: auto;
            display: block;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
            background-color: #2a2a2a;
            min-height: 160px;
        }
        .game-item p {
            margin: 10px 0;
            font-size: 0.9em;
            color: #fff;
            text-shadow: 0 0 4px rgba(255, 255, 255, 0.4);
            padding: 0 5px;
        }

        /* Estilos para el Modal del Juego */
        .game-modal {
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s;
        }

        .game-modal.is-open {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s;
        }

        .game-modal-content {
            background-color: #1c1c1c;
            padding: 20px;
            border: 1px solid #444;
            width: 90%;
            max-width: 840px; /* Ancho para acomodar un iframe de 800px + padding */
            border-radius: 10px;
            position: relative;
            color: #f0f0f0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transform: translateY(-30px) scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        .game-modal.is-open .game-modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .game-modal-close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            line-height: 1;
        }

        .game-modal-close-button:hover,
        .game-modal-close-button:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }

        #gameModalIframe {
            width: 100%; /* El iframe ocupará el ancho del contenido del modal */
            height: 450px; /* Altura base, puedes ajustarla. 800x450 es una proporción común */
            border: none;
            margin-top: 10px; /* Espacio debajo del título/botón de cierre */
        }

        body.modal-blur-active > .gallery-container {
            filter: blur(5px);
            transition: filter 0.3s ease-in-out;
        }
        .gallery-container { /* Para asegurar un des-desenfoque suave */
            transition: filter 0.3s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="gallery-container">
        <a href="#" data-game-id="metal-slug" data-game-src="https://www.retrogames.cc/embed/9157-metal-slug-super-vehicle-001.html" class="game-item">
            <img src="portadas/metal-slug.png" loading="lazy">
            <p>Metal Slug</p>
        </a>
    </div>

    <!-- Modal del Juego -->
    <div id="gameModal" class="game-modal">
        <div class="game-modal-content">
            <span class="game-modal-close-button">&times;</span>
            <h2 id="modalGameTitle" style="margin-top: 0; margin-bottom: 15px;">Nombre del Juego</h2>
            <iframe id="gameModalIframe" src="about:blank" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true" scrolling="no"></iframe>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.4.0/color-thief.umd.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const gameItems = document.querySelectorAll('.game-item');
            const colorThief = new ColorThief();

            const gameModal = document.getElementById('gameModal');
            const gameModalCloseButton = gameModal.querySelector('.game-modal-close-button');
            const gameModalIframe = document.getElementById('gameModalIframe');
            const modalGameTitle = document.getElementById('modalGameTitle');

            gameItems.forEach(item => {
                const img = item.querySelector('img');
                let dynamicGlowColors = null;

                function processLoadedImage() {
                    img.style.opacity = '1';
                    if (img.complete && img.naturalWidth > 0 && img.naturalHeight > 0) {
                        try {
                            const dominantColorArray = colorThief.getColor(img);
                            if (dominantColorArray) {
                                dynamicGlowColors = {};
                                const rgbString = `rgb(${dominantColorArray[0]}, ${dominantColorArray[1]}, ${dominantColorArray[2]})`;
                                dynamicGlowColors['--dominant-glow-color'] = rgbString;
                                if (item.matches(':hover')) {
                                    item.style.setProperty('--dominant-glow-color', rgbString);
                                }
                            } else {
                                dynamicGlowColors = null;
                            }
                        } catch (error) {
                            console.error('ColorThief error para la imagen:', img.src, error);
                            dynamicGlowColors = null;
                        }
                    } else if (!img.complete) {
                        // La imagen aún no está completamente cargada, el evento 'load' se encargará.
                    } else {
                         dynamicGlowColors = null;
                    }
                }

                if (img.complete && img.naturalWidth > 0) {
                    processLoadedImage();
                }
                img.addEventListener('load', processLoadedImage);

                img.addEventListener('error', () => {
                    img.style.opacity = '1'; 
                    dynamicGlowColors = null;
                });

                item.addEventListener('mouseenter', () => {
                    if (dynamicGlowColors && dynamicGlowColors['--dominant-glow-color']) {
                        item.style.setProperty('--dominant-glow-color', dynamicGlowColors['--dominant-glow-color']);
                    }
                });

                item.addEventListener('mouseleave', () => {
                    setTimeout(() => {
                        if (dynamicGlowColors && !item.matches(':hover')) {
                            item.style.removeProperty('--dominant-glow-color');
                        }
                    }, 400); 
                });

                // Aquí podrías añadir lógica de clic si estos items deben abrir un modal o un juego específico
                // Por ahora, el href="#" no hace nada.
                item.addEventListener('click', (event) => {
                    event.preventDefault();
                    const gameId = item.dataset.gameId;
                    const gameSrc = item.dataset.gameSrc;
                    const gameName = item.querySelector('p').textContent;

                    if (gameSrc) {
                        openGameModal(gameName, gameSrc);
                    } else {
                        console.warn(`No se encontró 'data-game-src' para el juego: ${gameId}`);
                        // Opcionalmente, podrías mostrar un mensaje al usuario
                        // alert(`El juego '${gameName}' no está disponible para jugar directamente aquí.`);
                    }
                });
            });

            function openGameModal(gameName, gameSrc) {
                modalGameTitle.textContent = gameName;
                gameModalIframe.src = gameSrc;
                document.body.classList.add('modal-blur-active');
                gameModal.classList.add('is-open');
            }

            function closeGameModal() {
                document.body.classList.remove('modal-blur-active');
                gameModal.classList.remove('is-open');
                // Importante: Detener el juego y liberar recursos
                gameModalIframe.src = 'about:blank'; 
                modalGameTitle.textContent = 'Nombre del Juego'; // Resetear título
            }

            gameModalCloseButton.addEventListener('click', closeGameModal);

            window.addEventListener('click', (event) => {
                if (event.target === gameModal) {
                    closeGameModal();
                }
            });

            window.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && gameModal.classList.contains('is-open')) {
                    closeGameModal();
                }
            });
        });
    </script>
</body>
</html>